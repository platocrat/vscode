/*
 * Wallaby.js - v1.0.963
 * https://wallabyjs.com
 * Copyright (c) 2014-2020 Wallaby.js - All Rights Reserved.
 *
 * This source code file is a part of Wallaby.js and is a proprietary (closed source) software.

 * IMPORTANT:
 * Wallaby.js is a tool made by software developers for software developers with passion and love for what we do.
 * Pirating the tool is not only illegal and just morally wrong,
 * it is also unfair to other fellow programmers who are using it legally,
 * and very harmful for the tool and its future.
 */
var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},__assign.apply(this,arguments)},__values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Q=require("q"),path=require("path"),tracer=global.$_$tracer,Runner,Test,runner,avaInstalled=!1,errorFormatter,format,improperUsage,onBeforeTest,onAfterTest;try{var nodeFs=require("fs"),originalRenameSync=nodeFs.renameSync;originalRenameSync.alreadyReplaced||(nodeFs.renameSync=function(e,t){var i=originalRenameSync.apply(this,arguments);if((".snap"===path.extname(t)||".md"===path.extname(t))&&0===t.indexOf(global.wallaby.projectCacheDir)){var n=require("fs-extra"),r=path.join(global.wallaby.localProjectDir,path.relative(global.wallaby.projectCacheDir,t));r&&(n.ensureDirSync(path.dirname(r)),nodeFs.writeFileSync(r,nodeFs.readFileSync(t)))}return i},nodeFs.renameSync.alreadyReplaced=!0);var Module=require("module").Module,modulePrototype=Module.prototype,originalRequire=modulePrototype.require;modulePrototype.require=function(e){if("ava"===e){var t=runner.test||runner.chain.test||runner.chain;return t["default"]=t,t.test=t,t}if("empower-core"===e){var i=originalRequire.call(this,e),n=function(){var e=arguments[1].onError;return arguments[1].onError=function(t){return t.originalMessage=t.error.message+"\n",e.apply(this,arguments)},i.apply(this,arguments)};return n.defaultOptions=i.defaultOptions,n}return originalRequire.call(this,e)};var changeTestMetadata=function(e){e.metadata.serial=!0,e.metadata._ignored="test"===e.metadata.type&&tracer.hasSpecFilter()&&!tracer.specFilter([e.title]),e.metadata._testFile=tracer.entryFile(),e.metadata._ignored&&(e.metadata.skipped=!0)};try{require("ava/lib/worker/options").set({})}catch(e){}try{var originalCreateChain=require("ava/lib/create-chain");require.cache[require.resolve("ava/lib/create-chain")].exports=function(){var e=arguments[0];return arguments[0]=function(t,i){return changeTestMetadata({metadata:t,title:"string"==typeof i[0]?i[0]:void 0}),e.apply(this,arguments)},originalCreateChain.apply(this,arguments)}}catch(e){}try{require("ava/lib/chalk").set({enabled:!1})}catch(e){}try{improperUsage=require("ava/lib/reporters/improper-usage-messages")}catch(e){}var originalObjectDefineProperty=Object.defineProperty;Object.defineProperty=function(e,t,i){return"AssertionError"===t&&(i.writable=!0),originalObjectDefineProperty.apply(this,arguments)},require("ava/lib/assert"),Runner=require("ava/lib/runner"),Object.defineProperty=originalObjectDefineProperty;try{errorFormatter=require("ava/lib/enhance-assert").formatter;try{errorFormatter()&&(errorFormatter=errorFormatter())}catch(e){}}catch(e){errorFormatter=null}Test=require("ava/lib/test");var originalTestRun=Test.prototype.run;Test.prototype.run=function(){onBeforeTest(this);try{tracer.specSyncStart();var e=originalTestRun.apply(this,arguments);return e.then&&e.then(function(e){return onAfterTest(e),e}),e}finally{tracer.specSyncEnd()}},avaInstalled=!0}catch(e){tracer.start(function(){tracer.reportGlobalError("ava node module is not found or the version is not supported, missing `npm install ava --save-dev`?\n"+(e.stack||""))}),module.exports={init:function(){return{configure:function(){}}}}}if(avaInstalled){var testFiles=[],options={},util=require("util"),truncate=function(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e},getMessage=function(e){return truncate(util.inspect(e.actual),128)+" "+e.operator+" "+truncate(util.inspect(e.expected),128)};tracer.start(function(){var e=global.$_$session,t=!1,i=function(){return e!==global.$_$session},n=function(){t||i()||(t=!0,tracer.complete())},r=function(e){return"test"!==e.metadata.type},s=tracer.initialSpecId();tracer.started({total:"unknown number of"});var o=Q.when(!0);testFiles.forEach(function(e){o=o.then(function(){var t,n,o,a,l,c;try{require("ava/lib/globals").options={file:e},delete require("ava/lib/snapshot-state").state}catch(u){}runner=new Runner(__assign(__assign({},options),{file:e,projectDir:global.wallaby.projectCacheDir,updateSnapshots:tracer.canUpdateSnapshots()})),onBeforeTest=function(e){i()||r(e)||(e.metadata._id=++s,tracer.specStart(e.metadata._id,e.title))},onAfterTest=function(e){if(!i()){var t=e.passed;e=e.result?e.result:e;var n=r(e);if(!t||!n){var s=e.metadata.skipped||e.metadata.todo,o=tracer.specEnd(),a=e.metadata.skipped?"skipped":e.metadata.todo?"todo":"executed",l={id:e.metadata._id,timeRange:o,name:e.title,suite:[],status:a,time:void 0===e.duration?0:e.duration,log:[],hook:n?e.metadata.type:void 0,testFile:e.metadata&&e.metadata._testFile||void 0};if(!t&&!s){var c=e.assertError||e.error;if("Error thrown in test"===c.message&&delete c.message,c.powerAssertContext&&errorFormatter&&(c.message=errorFormatter(c.powerAssertContext)),improperUsage){var u=improperUsage.forError(c);u&&(c.message=(c.message||"")+"\n"+u)}c.showDiff=!0;var h={message:c.message,stack:c.stack};/^\s+$/.test(h.message)?h.message=getMessage(c):!h.message&&format?h.message=format.formatSerializedError(c):c.values&&c.values.length&&(h.message=(h.message?h.message+"\n":"")+c.values[0].formatted),c.raw&&(c.actual=c.raw.actual,c.expected=c.raw.expected),tracer.setAssertionData(c,h),l.log.push(h)}l.log.length||delete l.log,tracer.result(l)}}};try{require(e);var h=!1,f=[];if(runner.tasks.serial)try{for(var d=__values(runner.tasks.serial),p=d.next();!p.done;p=d.next()){var g=p.value;!h&&(h=g.metadata.exclusive)||g.metadata.skipped&&f.push(g)}}catch(v){t={error:v}}finally{try{p&&!p.done&&(n=d["return"])&&n.call(d)}finally{if(t)throw t.error}}if(h)f=[];else if(runner.tasks.todo)try{for(var y=__values(runner.tasks.todo),m=y.next();!m.done;m=y.next()){var g=m.value;f.push(g)}}catch(_){o={error:_}}finally{try{m&&!m.done&&(a=y["return"])&&a.call(y)}finally{if(o)throw o.error}}try{for(var b=__values(f),T=b.next();!T.done;T=b.next()){var g=T.value;g.metadata._ignored||(onBeforeTest(g),onAfterTest(g))}}catch(S){l={error:S}}finally{try{T&&!T.done&&(c=b["return"])&&c.call(b)}finally{if(l)throw l.error}}var k=function(){runner.saveSnapshotState&&runner.saveSnapshotState()};return Q.promise(function(e){runner.on("error",function(e){throw e}),runner.on("start",function(t){return e(t.ended.then(k))}),runner.on("finish",function(){return k(),e()}),runner.start(),runner.start=function(){}})}catch(u){return tracer.reportDeclarationError(u),Q.when(!0)}})}),o.then(n)}),module.exports={init:function(e){return testFiles=e,options}}}